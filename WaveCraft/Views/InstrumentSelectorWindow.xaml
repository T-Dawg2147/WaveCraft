<Window x:Class="WaveCraft.Views.InstrumentSelectorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Instrument Selector"
        Width="800" Height="550"
        MinWidth="700" MinHeight="450"
        Background="{StaticResource AbletonBackground}"
        WindowStartupLocation="CenterOwner">

    <Window.Resources>
        <!-- Instrument Card Style -->
        <Style x:Key="InstrumentCard" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AbletonPanel}"/>
            <Setter Property="Foreground" Value="{StaticResource AbletonTextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource AbletonBorder}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Height" Value="80"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource AbletonHover}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource AbletonBorder}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Category List Item Style -->
        <Style x:Key="CategoryItem" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource AbletonTextSecondary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="{TemplateBinding Background}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource AbletonHover}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="{StaticResource AbletonOrange}"/>
                                <Setter Property="Foreground" Value="{StaticResource AbletonTextHighlight}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Instrument List Item Style -->
        <Style x:Key="InstrumentListItem" TargetType="ListViewItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource AbletonTextPrimary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{StaticResource AbletonBorder}"
                                BorderThickness="0,0,0,1"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource AbletonHover}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="{StaticResource AbletonOrange}"/>
                                <Setter Property="Foreground" Value="{StaticResource AbletonTextHighlight}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top Bar: Search & Actions -->
        <Border Grid.Row="0" Background="{StaticResource AbletonPanel}"
                BorderBrush="{StaticResource AbletonBorder}" BorderThickness="0,0,0,1">
            <Grid Margin="12,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0" 
                         x:Name="SearchBox"
                         VerticalContentAlignment="Center"
                         Height="28" Margin="0,0,8,0"
                         Text="Search instruments..."/>

                <Button Grid.Column="1" Content="Load SoundFont" 
                        Command="{Binding LoadSoundFontCommand}"
                        MinWidth="100" Margin="0,0,4,0"/>
                <Button Grid.Column="2" Content="Load VST" 
                        Command="{Binding LoadVstCommand}"
                        MinWidth="80" Margin="0,0,4,0"/>
                <Button Grid.Column="3" Content="Remove" 
                        Command="{Binding RemoveInstrumentsCommand}"
                        MinWidth="70"/>
            </Grid>
        </Border>

        <!-- Main Content: Categories (25%) + Instrument Grid (75%) -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="25*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="75*"/>
            </Grid.ColumnDefinitions>

            <!-- Left: Categories -->
            <Border Grid.Column="0" Background="{StaticResource AbletonPanel}"
                    BorderBrush="{StaticResource AbletonBorder}" BorderThickness="0,0,1,0">
                <StackPanel Margin="0">
                    <TextBlock Text="CATEGORIES" 
                               Foreground="{StaticResource AbletonTextSecondary}"
                               FontSize="9" FontWeight="Bold" 
                               Margin="12,12,12,8"/>
                    <ListBox Background="Transparent" BorderThickness="0"
                             ItemContainerStyle="{StaticResource CategoryItem}">
                        <ListBoxItem Content="All Instruments" IsSelected="True"/>
                        <ListBoxItem Content="Built-In Synths"/>
                        <ListBoxItem Content="SoundFonts"/>
                        <ListBoxItem Content="VST Instruments"/>
                        <ListBoxItem Content="Recent"/>
                    </ListBox>
                </StackPanel>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="1" 
                          Background="{StaticResource AbletonBorder}"
                          HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

            <!-- Right: Instrument Grid/List -->
            <Grid Grid.Column="2" Background="{StaticResource AbletonBackground}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled">
                    <ListView ItemsSource="{Binding Instruments}"
                              SelectedIndex="{Binding SelectedIndex}"
                              Background="Transparent"
                              BorderThickness="0"
                              ItemContainerStyle="{StaticResource InstrumentListItem}"
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0"
                                               Text="{Binding CategoryLabel}"
                                               Foreground="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=Foreground}"
                                               FontSize="10"
                                               VerticalAlignment="Center"
                                               Opacity="0.7"/>
                                    
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Name}"
                                               Foreground="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=Foreground}"
                                               FontSize="12"
                                               FontWeight="SemiBold"
                                               VerticalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </ScrollViewer>
            </Grid>
        </Grid>

        <!-- Preview Section -->
        <Border Grid.Row="2" Background="{StaticResource AbletonPanel}"
                BorderBrush="{StaticResource AbletonBorder}" BorderThickness="0,1,0,0">
            <StackPanel Margin="12,8" Orientation="Horizontal">
                <TextBlock Text="PREVIEW" 
                           Foreground="{StaticResource AbletonTextSecondary}"
                           FontSize="9" FontWeight="Bold"
                           VerticalAlignment="Center" Margin="0,0,12,0"/>
                <Button Content="C3" 
                        Command="{Binding PreviewNoteCommand}" CommandParameter="48"
                        MinWidth="40" Margin="0,0,4,0"/>
                <Button Content="C4" 
                        Command="{Binding PreviewNoteCommand}" CommandParameter="60"
                        MinWidth="40" Margin="0,0,4,0"/>
                <Button Content="C5" 
                        Command="{Binding PreviewNoteCommand}" CommandParameter="72"
                        MinWidth="40" Margin="0,0,4,0"/>
                <Button Content="E4" 
                        Command="{Binding PreviewNoteCommand}" CommandParameter="64"
                        MinWidth="40" Margin="0,0,4,0"/>
                <Button Content="G4" 
                        Command="{Binding PreviewNoteCommand}" CommandParameter="67"
                        MinWidth="40" Margin="0,0,4,0"/>
                <Button Content="A4" 
                        Command="{Binding PreviewNoteCommand}" CommandParameter="69"
                        MinWidth="40"/>
            </StackPanel>
        </Border>

        <!-- Bottom Bar: Status & Action Buttons -->
        <Border Grid.Row="3" Background="{StaticResource AbletonPanel}"
                BorderBrush="{StaticResource AbletonBorder}" BorderThickness="0,1,0,0">
            <Grid Margin="12,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="{Binding StatusText}"
                           Foreground="{StaticResource AbletonTextSecondary}"
                           VerticalAlignment="Center" FontSize="10"/>

                <Button Grid.Column="1" Content="Apply"
                        Click="OnApply_Click"
                        MinWidth="80" Padding="16,6" Margin="0,0,4,0"
                        Background="{StaticResource AbletonOrange}"
                        Foreground="{StaticResource AbletonTextHighlight}"/>
                
                <Button Grid.Column="2" Content="Cancel"
                        Click="OnCancel_Click"
                        MinWidth="80" Padding="16,6"/>
            </Grid>
        </Border>
    </Grid>
</Window>