<Window x:Class="WaveCraft.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:WaveCraft.Views.Controls"
        xmlns:converters="clr-namespace:WaveCraft.Converters"
        Title="{Binding Title}"
        Width="1400" Height="850"
        MinWidth="1100" MinHeight="700"
        Background="#FF1E1E2E"
        WindowStartupLocation="CenterScreen">

    <Window.InputBindings>
        <KeyBinding Key="Space" Command="{Binding Transport.PlayCommand}"/>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveProjectCommand}"/>
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{Binding OpenProjectCommand}"/>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding NewProjectCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding ExportWavCommand}"/>
        <KeyBinding Key="P" Modifiers="Ctrl" Command="{Binding OpenPianoRollCommand}"/>
        <KeyBinding Key="B" Modifiers="Ctrl" Command="{Binding OpenVstBrowserCommand}"/>
    </Window.InputBindings>

    <Window.Resources>
        <converters:DecibelConverter x:Key="DbConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVis"/>

        <Style x:Key="DarkButton" TargetType="Button">
            <Setter Property="Background" Value="#FF2D2D44"/>
            <Setter Property="Foreground" Value="#FFCDD6F4"/>
            <Setter Property="BorderBrush" Value="#FF45475A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF45475A"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#FF585B70"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="TransportButton" TargetType="Button" BasedOn="{StaticResource DarkButton}">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Padding" Value="0"/>
        </Style>

        <Style x:Key="MuteButton" TargetType="Button" BasedOn="{StaticResource DarkButton}">
            <Setter Property="Width" Value="28"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>

        <Style x:Key="LabelText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFA6ADC8"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="ValueText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FF6C7086"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="4,0,0,0"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ========== MENU BAR ========== -->
        <Menu Grid.Row="0" Background="#FF181825" Foreground="#FFCDD6F4">
            <MenuItem Header="_File">
                <MenuItem Header="_New Project" Command="{Binding NewProjectCommand}"
                          InputGestureText="Ctrl+N"/>
                <MenuItem Header="_Open Project" Command="{Binding OpenProjectCommand}"
                          InputGestureText="Ctrl+O"/>
                <Separator/>
                <MenuItem Header="_Save" Command="{Binding SaveProjectCommand}"
                          InputGestureText="Ctrl+S"/>
                <MenuItem Header="Save _As..." Command="{Binding SaveProjectAsCommand}"/>
                <Separator/>
                <MenuItem Header="Export _WAV..." Command="{Binding ExportWavCommand}"
                          InputGestureText="Ctrl+E"/>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="_MIDI">
                <MenuItem Header="Add _MIDI Track" Command="{Binding AddMidiTrackCommand}"/>
                <MenuItem Header="Open _Piano Roll" Command="{Binding OpenPianoRollCommand}"
              InputGestureText="Ctrl+P"/>
                <Separator/>
                <MenuItem Header="_Import MIDI File..." Command="{Binding ImportMidiCommand}"/>
                <MenuItem Header="_Export MIDI File..." Command="{Binding ExportMidiCommand}"/>
            </MenuItem>

            <MenuItem Header="_Plugins">
                <MenuItem Header="_VST Browser..." Command="{Binding OpenVstBrowserCommand}"
              InputGestureText="Ctrl+B"/>
            </MenuItem>
        </Menu>

        <!-- ========== TRANSPORT BAR ========== -->
        <Border Grid.Row="1" Background="#FF181825" Padding="8,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button Content="⏮" Style="{StaticResource TransportButton}"
                            Command="{Binding Transport.SkipToStartCommand}" ToolTip="Start"/>
                    <Button Content="⏹" Style="{StaticResource TransportButton}"
                            Command="{Binding Transport.StopCommand}" ToolTip="Stop"/>
                    <Button Style="{StaticResource TransportButton}"
                            Command="{Binding Transport.PlayCommand}" ToolTip="Play (Space)">
                        <Button.Content>
                            <TextBlock Text="▶" FontSize="18">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="#FFCDD6F4"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Transport.IsPlaying}" Value="True">
                                                <Setter Property="Foreground" Value="#FFA6E3A1"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Button.Content>
                    </Button>
                    <Button Content="⏸" Style="{StaticResource TransportButton}"
                            Command="{Binding Transport.PauseCommand}" ToolTip="Pause"/>
                    <Button Content="⏭" Style="{StaticResource TransportButton}"
                            Command="{Binding Transport.SkipToEndCommand}" ToolTip="End"/>
                </StackPanel>

                <!-- Position display -->
                <Border Grid.Column="1" Background="#FF11111B" CornerRadius="4"
                        Padding="12,4" Margin="12,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding Transport.PositionText}"
                                   Foreground="#FF89B4FA" FontFamily="Consolas"
                                   FontSize="22" VerticalAlignment="Center"/>
                        <TextBlock Text="  |  " Foreground="#FF45475A"
                                   FontSize="22" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding Transport.BarBeatText}"
                                   Foreground="#FFA6E3A1" FontFamily="Consolas"
                                   FontSize="22" VerticalAlignment="Center"/>
                        <TextBlock Text="  /  " Foreground="#FF45475A"
                                   FontSize="14" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding Transport.DurationText}"
                                   Foreground="#FF6C7086" FontFamily="Consolas"
                                   FontSize="14" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- BPM -->
                <StackPanel Grid.Column="3" Orientation="Horizontal"
                            VerticalAlignment="Center" Margin="12,0">
                    <TextBlock Text="BPM:" Foreground="#FFA6ADC8"
                               VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBox Text="{Binding Transport.Bpm, StringFormat=F0,
                                 UpdateSourceTrigger=LostFocus}"
                             Width="50" Background="#FF2D2D44"
                             Foreground="#FFFAB387" FontFamily="Consolas"
                             BorderBrush="#FF45475A" Padding="4,2"
                             VerticalContentAlignment="Center"
                             CaretBrush="#FFFAB387"/>
                </StackPanel>

                <!-- Master peak meters -->
                <StackPanel Grid.Column="4" Orientation="Horizontal" Margin="12,0,0,0">
                    <TextBlock Text="L" Foreground="#FF6C7086" FontSize="10"
                               VerticalAlignment="Center" Margin="0,0,2,0"/>
                    <controls:PeakMeterControl Width="12" Height="36"
                        PeakLevel="{Binding Transport.LeftPeak}"
                        RmsLevel="{Binding Transport.LeftRms}"/>
                    <controls:PeakMeterControl Width="12" Height="36" Margin="2,0"
                        PeakLevel="{Binding Transport.RightPeak}"
                        RmsLevel="{Binding Transport.RightRms}"/>
                    <TextBlock Text="R" Foreground="#FF6C7086" FontSize="10"
                               VerticalAlignment="Center" Margin="2,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ========== MAIN CONTENT ========== -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="3*"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="2*"/>
            </Grid.RowDefinitions>

            <!-- ==== TOP: TRACK LIST / TIMELINE ==== -->
            <Border Grid.Row="0" Background="#FF11111B">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="230"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Track headers panel -->
                    <Border Grid.Column="0" Background="#FF181825">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="4">
                                <Button Content="➕ Add Track"
                                        Style="{StaticResource DarkButton}"
                                        Command="{Binding Mixer.AddTrackCommand}"
                                        HorizontalAlignment="Stretch" Margin="0,0,0,6"/>

                                <ItemsControl ItemsSource="{Binding Mixer.Tracks}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#FF2D2D44" CornerRadius="4"
                                                    Padding="8,6" Margin="0,2" MinHeight="90">
                                                <StackPanel>
                                                    <!-- Track name -->
                                                    <TextBox Text="{Binding Name, Mode=TwoWay,
                                                                 UpdateSourceTrigger=LostFocus}"
                                                             Background="Transparent"
                                                             Foreground="#FFCDD6F4"
                                                             BorderThickness="0"
                                                             FontWeight="Bold" FontSize="13"
                                                             CaretBrush="#FFCDD6F4"/>

                                                    <!-- Volume -->
                                                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                        <TextBlock Text="Vol:" Style="{StaticResource LabelText}" Width="28"/>
                                                        <Slider Minimum="0" Maximum="2" Width="90"
                                                                Value="{Binding Volume}"/>
                                                        <TextBlock Text="{Binding VolumeDb}"
                                                                   Style="{StaticResource ValueText}"/>
                                                    </StackPanel>

                                                    <!-- Pan -->
                                                    <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                                        <TextBlock Text="Pan:" Style="{StaticResource LabelText}" Width="28"/>
                                                        <Slider Minimum="-1" Maximum="1" Width="90"
                                                                Value="{Binding Pan}"/>
                                                        <TextBlock Text="{Binding PanLabel}"
                                                                   Style="{StaticResource ValueText}"/>
                                                    </StackPanel>

                                                    <!-- Mute / Solo / Import -->
                                                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                        <Button Content="M" Style="{StaticResource MuteButton}"
                                                                Command="{Binding ToggleMuteCommand}"
                                                                ToolTip="Mute"/>
                                                        <Button Content="S" Style="{StaticResource MuteButton}"
                                                                Command="{Binding ToggleSoloCommand}"
                                                                ToolTip="Solo"/>
                                                        <Button Content="📂 Import"
                                                                Style="{StaticResource DarkButton}"
                                                                Command="{Binding ImportAudioCommand}"
                                                                FontSize="11" Padding="6,3"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <!-- Timeline / Clip area -->
                    <!-- Timeline / Clip area -->
                    <Border Grid.Column="1" Background="#FF11111B" Padding="0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="32"/>
                                <!-- Timeline ruler -->
                                <RowDefinition Height="*"/>
                                <!-- Track clips -->
                            </Grid.RowDefinitions>

                            <!-- Timeline ruler with playhead -->
                            <controls:PlayheadTimelineControl
                                x:Name="TimelineRuler"
                                Grid.Row="0"
                                PlayheadPosition="{Binding Transport.PlayheadPosition, Mode=TwoWay}"
                                TotalDuration="{Binding Transport.TotalDuration}"
                                IsPlaying="{Binding Transport.IsPlaying}"
                                Bpm="{Binding Transport.Bpm}"/>

                            <!-- Track clips with playhead overlay -->
                            <Grid Grid.Row="1">
                                <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                              VerticalScrollBarVisibility="Auto">
                                    <ItemsControl ItemsSource="{Binding Mixer.Tracks}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#FF1A1A2E" CornerRadius="4"
                                                        Margin="0,2" MinHeight="90"
                                                        BorderBrush="#FF313244" BorderThickness="1">
                                                    <ItemsControl ItemsSource="{Binding Clips}">
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <Canvas/>
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border Background="#FF313244"
                                                                        CornerRadius="3"
                                                                        BorderBrush="#FF585B70"
                                                                        BorderThickness="1"
                                                                        MinWidth="60" Height="80"
                                                                        Padding="2"
                                                                        ToolTip="{Binding Name}">
                                                                    <Grid>
                                                                        <Grid.RowDefinitions>
                                                                            <RowDefinition Height="Auto"/>
                                                                            <RowDefinition Height="*"/>
                                                                        </Grid.RowDefinitions>

                                                                        <TextBlock Grid.Row="0"
                                                                            Text="{Binding Name}"
                                                                            Foreground="#FFCDD6F4"
                                                                            FontSize="10"
                                                                            Margin="2,0"/>

                                                                        <controls:WaveformControl
                                                                            Grid.Row="1"
                                                                            Waveform="{Binding WaveformData}"
                                                                            WaveColor="#FF89B4FA"
                                                                            RmsColor="#FF45475A"
                                                                            BackgroundColor="#FF1A1A2E"/>
                                                                    </Grid>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>

                                <!-- Playhead vertical line overlay -->
                                <controls:PlayheadLineOverlay
                                    PlayheadPosition="{Binding Transport.PlayheadPosition}"
                                    IsHitTestVisible="False"/>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Row="1" Height="5"
                          HorizontalAlignment="Stretch"
                          Background="#FF313244" Cursor="SizeNS"/>

            <!-- BOTTOM: MIXER + EFFECTS -->
            <Border Grid.Row="2" Background="#FF181825">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="320"/>
                    </Grid.ColumnDefinitions>

                    <!-- Mixer channels -->
                    <ScrollViewer Grid.Column="0"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Disabled">
                        <StackPanel Orientation="Horizontal" Margin="4">
                            <!-- Track mixer strips -->
                            <ItemsControl ItemsSource="{Binding Mixer.Tracks}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#FF2D2D44" CornerRadius="4"
                                                Width="100" Margin="2" Padding="6">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Name}"
                                                           Foreground="#FFCDD6F4"
                                                           FontWeight="Bold" FontSize="11"
                                                           HorizontalAlignment="Center"
                                                           TextTrimming="CharacterEllipsis"
                                                           Margin="0,0,0,4"/>

                                                <!-- Vertical fader -->
                                                <Slider Orientation="Vertical"
                                                        Minimum="0" Maximum="2"
                                                        Value="{Binding Volume}"
                                                        Height="120"
                                                        HorizontalAlignment="Center"/>

                                                <TextBlock Text="{Binding VolumeDb}"
                                                           Foreground="#FF6C7086"
                                                           FontSize="10"
                                                           HorizontalAlignment="Center"
                                                           Margin="0,4,0,0"/>

                                                <!-- Pan knob (as slider) -->
                                                <Slider Minimum="-1" Maximum="1"
                                                        Value="{Binding Pan}"
                                                        Width="80" Margin="0,4,0,0"/>
                                                <TextBlock Text="{Binding PanLabel}"
                                                           Foreground="#FF6C7086" FontSize="9"
                                                           HorizontalAlignment="Center"/>

                                                <!-- Mute/Solo -->
                                                <StackPanel Orientation="Horizontal"
                                                            HorizontalAlignment="Center"
                                                            Margin="0,6,0,0">
                                                    <Button Content="M" Style="{StaticResource MuteButton}"
                                                            Command="{Binding ToggleMuteCommand}"/>
                                                    <Button Content="S" Style="{StaticResource MuteButton}"
                                                            Command="{Binding ToggleSoloCommand}"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Master channel strip -->
                            <Border Background="#FF3B3B58" CornerRadius="4"
                                    Width="110" Margin="8,2,2,2" Padding="6">
                                <StackPanel>
                                    <TextBlock Text="MASTER" Foreground="#FFFAB387"
                                               FontWeight="Bold" FontSize="12"
                                               HorizontalAlignment="Center"
                                               Margin="0,0,0,4"/>

                                    <Slider Orientation="Vertical"
                                            Minimum="0" Maximum="2"
                                            Value="{Binding Mixer.MasterVolume}"
                                            Height="120"
                                            HorizontalAlignment="Center"/>

                                    <TextBlock Text="{Binding Mixer.MasterVolumeDb}"
                                               Foreground="#FF6C7086" FontSize="10"
                                               HorizontalAlignment="Center"
                                               Margin="0,4,0,0"/>

                                    <!-- Master meters -->
                                    <StackPanel Orientation="Horizontal"
                                                HorizontalAlignment="Center"
                                                Margin="0,6,0,0">
                                        <controls:PeakMeterControl Width="16" Height="50"
                                            PeakLevel="{Binding Transport.LeftPeak}"
                                            RmsLevel="{Binding Transport.LeftRms}"/>
                                        <controls:PeakMeterControl Width="16" Height="50"
                                            Margin="3,0"
                                            PeakLevel="{Binding Transport.RightPeak}"
                                            RmsLevel="{Binding Transport.RightRms}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Splitter -->
                    <GridSplitter Grid.Column="1" Width="5"
                                  VerticalAlignment="Stretch"
                                  Background="#FF313244" Cursor="SizeWE"/>

                    <!-- Effect chain panel -->
                    <Border Grid.Column="2" Background="#FF1A1A2E" Padding="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Header -->
                            <TextBlock Grid.Row="0" Text="EFFECT CHAIN"
                                       Foreground="#FFA6ADC8" FontWeight="Bold"
                                       FontSize="12" Margin="0,0,0,6"/>

                            <!-- Add effect buttons -->
                            <WrapPanel Grid.Row="1" Margin="0,0,0,6">
                                <Button Content="+ Gain" Style="{StaticResource DarkButton}"
                                        FontSize="10" Padding="6,3"
                                        Command="{Binding Mixer.MasterEffects.AddEffectCommand}"
                                        CommandParameter="Gain"/>
                                <Button Content="+ Delay" Style="{StaticResource DarkButton}"
                                        FontSize="10" Padding="6,3"
                                        Command="{Binding Mixer.MasterEffects.AddEffectCommand}"
                                        CommandParameter="Delay"/>
                                <Button Content="+ Reverb" Style="{StaticResource DarkButton}"
                                        FontSize="10" Padding="6,3"
                                        Command="{Binding Mixer.MasterEffects.AddEffectCommand}"
                                        CommandParameter="Reverb"/>
                                <Button Content="+ EQ" Style="{StaticResource DarkButton}"
                                        FontSize="10" Padding="6,3"
                                        Command="{Binding Mixer.MasterEffects.AddEffectCommand}"
                                        CommandParameter="3-Band EQ"/>
                                <Button Content="+ Compressor" Style="{StaticResource DarkButton}"
                                        FontSize="10" Padding="6,3"
                                        Command="{Binding Mixer.MasterEffects.AddEffectCommand}"
                                        CommandParameter="Compressor"/>
                                <Button Content="+ Gate" Style="{StaticResource DarkButton}"
                                        FontSize="10" Padding="6,3"
                                        Command="{Binding Mixer.MasterEffects.AddEffectCommand}"
                                        CommandParameter="Noise Gate"/>
                                <Button Content="+ Fade" Style="{StaticResource DarkButton}"
                                        FontSize="10" Padding="6,3"
                                        Command="{Binding Mixer.MasterEffects.AddEffectCommand}"
                                        CommandParameter="Fade"/>
                            </WrapPanel>

                            <!-- Effect slots with auto-generated parameters -->
                            <ScrollViewer Grid.Row="2"
                                          VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding Mixer.MasterEffects.Slots}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#FF2D2D44" CornerRadius="4"
                                                    Padding="8,6" Margin="0,2">
                                                <StackPanel>
                                                    <!-- Effect header -->
                                                    <StackPanel Orientation="Horizontal">
                                                        <CheckBox IsChecked="{Binding IsEnabled}"
                                                                  VerticalAlignment="Center"
                                                                  Margin="0,0,6,0"/>
                                                        <TextBlock Text="{Binding Name}"
                                                                   Foreground="#FFCDD6F4"
                                                                   FontWeight="Bold"
                                                                   FontSize="12"
                                                                   VerticalAlignment="Center"/>
                                                    </StackPanel>

                                                    <!-- Auto-generated parameter sliders -->
                                                    <ItemsControl ItemsSource="{Binding Parameters}"
                                                                  Margin="0,6,0,0">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Grid Margin="0,2">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="80"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="70"/>
                                                                    </Grid.ColumnDefinitions>

                                                                    <TextBlock Grid.Column="0"
                                                                        Text="{Binding Name}"
                                                                        Foreground="#FFA6ADC8"
                                                                        FontSize="10"
                                                                        VerticalAlignment="Center"/>

                                                                    <Slider Grid.Column="1"
                                                                        Minimum="{Binding MinValue}"
                                                                        Maximum="{Binding MaxValue}"
                                                                        Value="{Binding Value}"
                                                                        VerticalAlignment="Center"/>

                                                                    <TextBlock Grid.Column="2"
                                                                        Text="{Binding DisplayText}"
                                                                        Foreground="#FF89B4FA"
                                                                        FontSize="10" FontFamily="Consolas"
                                                                        VerticalAlignment="Center"
                                                                        HorizontalAlignment="Right"/>
                                                                </Grid>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- ========== STATUS BAR ========== -->
        <Border Grid.Row="3" Background="#FF181825" Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="{Binding StatusText}"
                           Foreground="#FFA6ADC8" FontSize="11"/>

                <TextBlock Grid.Column="1"
                           Foreground="#FF6C7086" FontSize="10">
                    <Run Text="Tracks: "/>
                    <Run Text="{Binding Mixer.Tracks.Count, Mode=OneWay}"/>
                    <Run Text="  |  Sample Rate: 44100 Hz  |  Stereo"/>
                </TextBlock>
            </Grid>
        </Border>
    </Grid>
</Window>